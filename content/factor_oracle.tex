\begin{frame}{Factor Oracle}
  \framesubtitle{Overview}
  \begin{center}
    \begin{tikzpicture}
      \begin{scope}
        \node[state] (s0)   {0};

        % internal transitions
        \foreach \dest/\sym/\lrs [remember=\dest as \src (initially 0)] in {1/a/0,2/b/0,3/b/1,4/c/0,5/a/1,6/b/2,7/c/2,8/d/0,9/a/1,10/b/2,11/c/3} {
          \node[state, right of = s\src]  (s\dest)   {\dest};

          \path (s\src) edge [trans] node [font=\scriptsize, above,
          yshift=-1mm, xshift=-1mm, pos=0.7, ballblue] {\sym} (s\dest);

          % lrs
          \node[right of = s\dest,node distance =
          3.5mm,font=\scriptsize, yshift=-1.5mm, antiquefuchsia] {\lrs};
        }

        % forwards transitions
        \foreach \src/\dest/\sym in {0/2/b, 2/4/c, 0/4/c, 4/8/d, 0/8/d} {
          \path (s\src) edge [trans, bend right=40] node
          [font=\scriptsize,below, pos=1, ballblue] {\sym} (s\dest);
        }

        % suffix links
        \foreach \src/\dest in {1/0, 2/0, 3/2, 4/0, 5/1, 6/2, 7/4, 8/0,
          9/1, 10/2, 11/7} {
          \path (s\src) edge [trans, dashed, draw=gray, bend right] (s\dest);
        }
    \end{scope}

    \begin{scope}[xshift=7.5cm, yshift=-1cm]
      \draw[trans,thick] (0,0) -- ++(1,0) node [anchor=west] {Forward
 Links};
      \draw[trans,thick,gray, dashed] (0,-0.5cm) -- ++(1,0) node [anchor=west] {Suffix Links};
    \end{scope}
  \end{tikzpicture}

  \only<1>{
    \begin{block}{Factor Oracle}
      The \alert{factor oracle} of a word $s$ of length $m$ is a
      \emph{deterministic finite automaton} $(Q, q_{0}, F, \delta)$
      where $Q = \{0,1,\dots,m\}$ is the set of states, $q_{0}=0$ is the
      starting state, $F = Q$ is the set of terminal states and $\delta$
      is the transition function.
    \end{block}}

  \only<2>{
    \begin{block}{Suffix Link}
      The \alert{suffix link} of a state $i$ of the factor oracle of a
      word $s$, is equal to the state in which the \emph{longest
        repeated suffix (lrs)} of $s[1\dots{}i]$ is recognized.
    \end{block}
  }
\end{center}

\end{frame}


\begin{frame}{Factor Oracle}
  \framesubtitle{Overview}
  \begin{center}
    \begin{tikzpicture}
      \begin{scope}
        \node[state] (s0)   {0};

        % internal transitions
        \foreach \dest/\sym/\lrs [remember=\dest as \src (initially 0)] in {1/a/0,2/b/0,3/b/1,4/c/0,5/a/1,6/b/2,7/c/2,8/d/0,9/a/1,10/b/2,11/c/3} {
          \node[state, right of = s\src]  (s\dest)   {\dest};

          \path (s\src) edge [trans] node [font=\scriptsize, above,
          yshift=-1mm, xshift=-1mm, pos=0.7, ballblue] {\sym} (s\dest);

          % lrs
          \node[right of = s\dest,node distance =
          3.5mm,font=\scriptsize, yshift=-1.5mm, antiquefuchsia] {\lrs};
        }

        % forwards transitions
        \foreach \src/\dest/\sym in {0/2/b, 2/4/c, 0/4/c, 4/8/d, 0/8/d} {
          \path (s\src) edge [trans, bend right=40] node
          [font=\scriptsize,below, pos=1, ballblue] {\sym} (s\dest);
        }

        % suffix links
        \foreach \src/\dest in {1/0, 2/0, 3/2, 4/0, 5/1, 6/2, 7/4, 8/0,
          9/1, 10/2, 11/7} {
          \path (s\src) edge [trans, dashed, draw=gray, bend right] (s\dest);
        }

        % highlighting
        \only<3>{
          \begin{pgfonlayer}{background}
            \path (s11) edge [draw,line width=5pt,-,orange!50, bend right] (s7);
            \path (s4) edge [draw,line width=18pt,-,arylideyellow!50] (s7);
            \foreach \i in {7, 11}{
              \node[state,fill=orange!50] at (s\i) {};
            }
          \end{pgfonlayer}
        }
      \end{scope}
    \end{tikzpicture}
\end{center}

\begin{block}{Suffix Links}
  \begin{itemize}[<+->]
  \item $s = \mathtt{abbc\textcolor<2>{red}{abc}d\textcolor<2>{red}{abc}}$
  \item $lrs(s) = \mathtt{abc}$
  \item $S(11) = 7$
  \end{itemize}
\end{block}
\end{frame}

\begin{frame}[fragile]{Factor Oracle}
  \framesubtitle{Algorithm}
  \begin{algorithm}[H] \caption{Construction of a Factor Oracle}\label{alg:fo}
    \begin{algorithmic}[1]
      \Function{FactorOracle}{$p=p_{1}p_{2}\dots{}p_{m}$}
      \State Create a new oracle $P$ with an initial state 0
      \State $S_{P}(0) \gets -1$
      \For{$i \gets 1, m$}
      \State $Oracle(p=p_{1}p_{2}\dots{}p_{i}) \gets$
      AddLetter($Oracle(p=p_{1}p_{2}\dots{}p_{i-1}), p_{i}$)
      \EndFor
      \State  \textbf{return} $Oracle(p=p_{1}p_{2}\dots{}p_{m})$
      \EndFunction
    \end{algorithmic}
  \end{algorithm}

  % EXAMPLE !
  \begin{center}
    \begin{tikzpicture}
      \visible<2->{
      \begin{scope}
        \foreach \w [count=\i from 0] in {a,b,b,c,a,b,c,d,a,b,c}  {
          \pgfmathsetmacro{\x}{\i*0.55}
          \node[Word] (symbol \i) at (\x,0) {\texttt{\w}};
        }
        \node (s) at (-0.6,0) {$p=$};
      \end{scope}}
      \begin{scope}[yshift=-1.5cm]
        \visible<3->{\node[state] (s0) {0};}
      \end{scope}
    \end{tikzpicture}
  \end{center}
\end{frame}

\begin{frame}[fragile]{Factor Oracle}
  \framesubtitle{Algorithm}
  \begin{algorithm}[H]
    \caption{Incremental update of Factor Oracle}\label{alg:addletter}
    \begin{algorithmic}[1]
      \Function{AddLetter}{$Oracle(p=p_{1},p_{2}\dots{}p_{m}),\sigma$}

      \only<1-4,9-11,19-21,26-28>{%
        \State Create state $m+1$
        \State Create a new transition from $m$ to $m+1$ labeled by
        $\sigma$ \Comment{$\delta(m,\sigma) = m+1$}
        \State $k \gets S_{p}(m)$
        \State $\pi_{1} \gets m$
        \State $\dots$
      }

      \only<5,12-15,22,29-35>{%
        \State $\dots$
        \While {$k > -1$ and there is no transition from $k$ by
          $\sigma$}
        \State Create a new transition from $k$ to $m+1$ by $\sigma$  \Comment{$\delta(k,\sigma) = m+1$}
        \State $\pi_{1} \gets k$
        \State $k \gets S_{p}(k)$
        \EndWhile
        \State $\dots$
      }


      \only<6-8,16-18,23-25,36-38>{
        \State $\dots$
        \If {$k = -1$}
        \State $S_{p\sigma} \gets 0$
        \State $lrs_{p\sigma} \gets 0$
        \Else
        \State $S_{p\sigma}\gets $ state that leads the transition
        from $k$ by $\sigma$
        \State $lrs_{p\sigma} \gets $ LengthCommonSuffix($\pi_{1},S(m+1)-1$) + 1
        \EndIf
        \State $\dots$
      }

      % \State $\dots$
      % \State $k \gets $ FindBetter($m+1, p[m+1-lrs(m+1)]$)
      % \If {$k \neq 0$}
      % \State $lrs_{p\sigma} \gets lrs(m+1) +1$
      % \State $S_{p\sigma} \gets k$
      % \EndIf
      % \State $T(S_{p\sigma}) \gets T(S(m+1)) \cup \{m+1\}$
      % \State \textbf{return} $Oracle(p=p_{1}p_{2}\dots{}p_{m}\sigma)$

      \EndFunction
    \end{algorithmic}
  \end{algorithm}

  % ------------------------------- EXAMPLE ! -------------------------------
  \begin{center}
    \begin{tikzpicture}
      \begin{scope}
        \visible<2->{
          \foreach \w [count=\i from 1] in {a,b,b,c,a,b,c,d,a,b,c}  {
            \pgfmathsetmacro{\x}{\i*0.55}
            \node[Word] (symbol \i) at (\x,0) {\texttt{\w}};
          }
          \node (s) at (-0.1,0) {$p=$};
        }
        \begin{pgfonlayer}{background}
          % current symbol
          \foreach \i/\f [count=\n from 1] in {2/8,9/18,19/25,26/38}  {
            \visible<\i-\f>{\node[Word,white,fill=orange!50] at (symbol \n) {};}
          }
        \end{pgfonlayer}

      \end{scope}

      \begin{scope}[yshift=-1.5cm]
        \visible<2->{\node[state] (s0) {0};}

        % forward internal link
        \foreach \dest/\sym/\slide [remember=\dest as \src (initially 0)] in {1/a/3,2/b/10,3/b/20,4/c/27}{%,5/a/27,6/b/33,7/c/39,8/d/45,9/a/51,10/b/57,11/c/63} {
          \visible<\slide->{
            \node[state, right of = s\src]  (s\dest)   {\dest};
            \path (s\src) edge [trans] node [font=\scriptsize, above,
            yshift=-1mm, xshift=-1mm, pos=0.7, ballblue] {\texttt{\sym}} (s\dest);
          }
        }

        % forward external link
        \foreach \src/\dest/\sym/\slide in {0/2/b/13, 2/4/c/30, 0/4/c/33}{
          \visible<\slide->{
            \path (s\src) edge [trans, bend right=40] node
            [font=\scriptsize,below, pos=1, ballblue] {\sym} (s\dest);
          }
        }

        % Suffix link
        \foreach \src/\dest/\slide in {1/0/7,2/0/17,3/2/24, 4/0/37} {
          \visible<\slide->{\path (s\src) edge [trans, dashed, draw=gray, bend right] (s\dest);}
        }

        % lrs
        \foreach \lrs/\slide [count=\s from 0] in {0/2, 0/8, 0/18,
          1/25, 0/38} {
          \visible<\slide->{
            \node[right of = s\s, node distance = 3.5mm,font=\scriptsize, yshift=-1.5mm, antiquefuchsia] {\lrs};
          }
        }

      \end{scope}


      \begin{scope}[xshift=7.5cm]

        % m
        \foreach \slideI/\slideF [count=\m from 0] in {2/8, 9/18,
          19/25, 26/38} {
          \visible<\slideI-\slideF>{\node (m) {$m = \m$};}
        }

        % k
        \foreach \k/\slideI/\slideF in {-1/4/8, 0/11/14, -1/15/18,
          0/21/25, 2/28/31, 0/32/34, -1/35/38} {
          \visible<\slideI-\slideF>{
            \node[right = 0.5mm of m] (k) {$k = \k$};
          }
        }

        % pi
        \foreach \p/\slideI/\slideF in {0/4/8, 1/11/13, 0/14/18,
          2/21/25, 3/28/30, 2/31/33, 0/34/38} {
          \visible<\slideI-\slideF>{
            \node[right = 0.5mm of k] (p) {$\pi_{1} = \p$};
          }
        }

        % lcs
        \foreach \pone/\ptwo/\r/\slideI/\slideF in {2/1/0/25/25} {
          \visible<\slideI-\slideF>{
            \node[below = 0.5mm of k] (lcs) {$lcs(\pone,\ptwo) = \r$};
          }
        }
      \end{scope}

      \begin{scope}[xshift=10cm, yshift=-2cm]
        \foreach \i in {1,...,40} {
          \only<\i>{\node {slide \i};}
        }
      \end{scope}
    \end{tikzpicture}
  \end{center}

\end{frame}

\begin{frame}[fragile]{Factor Oracle}
  \framesubtitle{Algorithm}
  \begin{algorithm}[H]
    \caption{Find Better Algorithm}\label{alg:fb}
    \begin{algorithmic}[1]
      \Function{FindBetter}{$i, a$}
      \For {all the elements $j$ of $T(\alt<2>{\alert{S(i)}}{i})$ in increasing order}
      \If {$lrs(j) = lrs(i)$ and $p[j-lrs(i)] = a$}
      \State \textbf{return} j
      \EndIf
      \EndFor
      \State \textbf{return} 0
      \EndFunction
    \end{algorithmic}
  \end{algorithm}
\end{frame}

\begin{frame}[fragile]{Factor Oracle}
  \framesubtitle{Algorithm}
  \begin{algorithm}[H]
    \caption{Length Common Suffix Algorithm}\label{alg:lcs}
    \begin{algorithmic}[1]
      \Function{LengthCommonSuffix}{$\pi_{1},\pi_{2}$}
      \If {$S(\pi_{1}) = \pi_{2}$}
      \State \textbf{return} $lrs(\pi_{1})$
      \Else
      \While {$S(\pi_{1}) \neq S(\pi_{2})$}
      \State $\pi_{2} \gets S(\pi_{2})$
      \EndWhile
      \EndIf
      \State \textbf{return} $min(lrs(\pi_{1}),lrs(\pi_{2}))$
      \EndFunction
    \end{algorithmic}
  \end{algorithm}
\end{frame}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../slides"
%%% End:
